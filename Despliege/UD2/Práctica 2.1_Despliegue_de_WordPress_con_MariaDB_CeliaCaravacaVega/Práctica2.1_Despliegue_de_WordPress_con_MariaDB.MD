# Pr√°ctica 2.1: Despliegue de WordPress con MariaDB

## üîπ Componentes de la Arquitectura

* **Servidor Web + WordPress:** Apache con PHP y WordPress (Imagen: `wordpress`).
  Puerto 80/tcp.
  Almacena contenido en `/var/www/html/wp-content`.

* **Base de Datos MariaDB:** Sistema relacional (Imagen: `mariadb`).
  Puerto 3306/tcp.
  Almacena datos en `/var/lib/mysql`.

---

## üîπ Parte 1: Despliegue b√°sico de WordPress

### Tarea 1.1: Preparaci√≥n del entorno

* **Red Docker:** Creaci√≥n de red personalizada `red_wp`.

  ![alt text](image.png)

* **Directorios en el host:** Creados `/opt/mysql_wp` y `/opt/wordpress`.

  ![alt text](image-1.png)

* **Investigaci√≥n:**

  * **MariaDB:** Requiere `MYSQL_DATABASE`, `MYSQL_USER`, `MYSQL_PASSWORD` y `MYSQL_ROOT_PASSWORD`.
  * **WordPress:** Requiere `WORDPRESS_DB_HOST`, `WORDPRESS_DB_USER`, `WORDPRESS_DB_PASSWORD` y `WORDPRESS_DB_NAME`.

---

### Tarea 1.2: Despliegue del contenedor de base de datos

```bash
docker run -d \
  --name servidor_mysql \
  --network red_wp \
  -v /opt/mysql_wp:/var/lib/mysql \
  -e MYSQL_DATABASE=bd_wp \
  -e MYSQL_USER=user_wp \
  -e MYSQL_PASSWORD=#Imprenta15 \
  -e MYSQL_ROOT_PASSWORD=SuperJoakii \
  mariadb
```

**Verificaci√≥n:**
Contenedor en ejecuci√≥n y logs revisados.

---

### Tarea 1.3: Despliegue del contenedor de WordPress

```bash
docker run -d \
  --name servidor_wp \
  --network red_wp \
  -v /opt/wordpress:/var/www/html/wp-content \
  -p 80:80 \
  -e WORDPRESS_DB_HOST=servidor_mysql \
  -e WORDPRESS_DB_USER=user_wp \
  -e WORDPRESS_DB_PASSWORD=#Imprenta15 \
  -e WORDPRESS_DB_NAME=bd_wp \
  wordpress
```

**Verificaci√≥n:**
Acceso a `http://localhost` funcionando.

---

### Tarea 1.4: Instalaci√≥n y configuraci√≥n de WordPress

* **Contenido:**
  Creadas p√°ginas (‚ÄúPruebecilla‚Äù y ‚ÄúLas maravillas de WordPress‚Äù) y 3 entradas.

* **Personalizaci√≥n:**
  Categor√≠a nueva, cambio de tema y plugin de cookies instalado.

---

## üîπ Parte 2: Verificaci√≥n de la persistencia

### Tarea 2.1: Persistencia de WordPress

Se elimin√≥ el contenedor `servidor_wp` y se volvi√≥ a crear.
El contenido, temas y plugins siguen presentes porque los datos est√°n en el volumen del host.

### Tarea 2.2: Persistencia de la base de datos

Se eliminaron ambos contenedores.
Tras recrearlos con la misma configuraci√≥n, toda la informaci√≥n se mantiene intacta.

---

## üîπ Parte 3: An√°lisis de la arquitectura

### Tarea 3.1: Comunicaci√≥n entre contenedores

* **Conectividad:**
  Se verific√≥ mediante `getent hosts servidor_mysql`.

* **Reflexi√≥n:**
  WordPress accede a MariaDB sin puertos expuestos porque est√°n en la misma red `red_wp`.
  En Docker, los contenedores en la misma red se ven en todos sus puertos.

---

### Tarea 3.2: Variables de entorno y configuraci√≥n autom√°tica

* **wp-config.php:**
  WordPress utiliza la funci√≥n `getenv_docker()` para vincular din√°micamente constantes como `DB_NAME` o `DB_USER`.

* **Entrypoint Scripts:**

  * **MariaDB:** Inicializa base de datos y usuarios.
  * **WordPress:** Genera autom√°ticamente `wp-config.php` antes de arrancar Apache.

---

## üîπ Parte 4: Configuraci√≥n avanzada

### Tarea 4.1: Cambio del nombre del servidor de base de datos

Se recrearon los contenedores cambiando el nombre a `mariadb_wordpress` y ajustando `WORDPRESS_DB_HOST`.

### Tarea 4.2: Exposici√≥n de la base de datos

```bash
mysql -h 127.0.0.1 -P 3307 -u user_wp -p
```

* `wp_posts`: Posts y p√°ginas.
* `wp_users`: Usuarios.
* `wp_options`: Opciones.

---

## üîπ Parte 5: An√°lisis y documentaci√≥n

### 5.1 Arquitectura de la aplicaci√≥n

* Base de datos: Informaci√≥n estructurada.
* Volumen: Archivos f√≠sicos.
* Comunicaci√≥n: Red interna Docker.

### 5.2 Persistencia de datos

* Sin vol√∫menes no se guardan cambios.
* Backups permiten recuperaci√≥n.

### 5.3 Seguridad

* No exponer MariaDB.
* Uso de Docker Secrets.

### 5.4 Scripts de inicializaci√≥n

* MariaDB inicializa motor y usuarios.
* WordPress genera `wp-config.php` al arrancar.

### 5.5 Comparaci√≥n

* Guestbook: ef√≠mero.
* WordPress: persistente y multicapa.

### 5.6 Escalabilidad

* Vol√∫menes compartidos.
* Galera Cluster.
* Punto √∫nico de fallo.
